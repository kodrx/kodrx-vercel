
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n de M√©dicos</title>
<link rel="stylesheet" href="/estilos/global.css" />
<script src="/componentes/header.js" defer></script>

</head>
<body>
  <h2>M√©dicos Registrados</h2>

  <div class="seccion">
    <h3>‚úÖ Verificados</h3>
    <div id="verificados"></div>
  </div>

  <div class="seccion">
    <h3>‚è≥ Pendientes de Verificaci√≥n</h3>
    <div id="pendientes"></div>
  </div>

  <script type="module">
    import { db } from '../firebase-init.js';
    import { collection, getDocs, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const verificadosDiv = document.getElementById("verificados");
    const pendientesDiv = document.getElementById("pendientes");

    async function cargarMedicos() {
      const querySnapshot = await getDocs(collection(db, "medicos"));
      querySnapshot.forEach((docSnap) => {
        const medico = docSnap.data();
        const id = docSnap.id;
        const contenedor = document.createElement("div");
        contenedor.classList.add("medico");
        contenedor.innerHTML = `
          <strong>${medico.nombre}</strong>
          <div class="detalles">
            <div>üìß ${medico.correo}</div>
            <div>üì± ${medico.telefono}</div>
            <div>üè† Colonia: ${medico.colonia}</div>
            <div>üåé Estado: ${medico.estado}</div>
            <div>üìÖ Fecha de registro: ${medico.fechaRegistro?.toDate().toLocaleString() || 'Sin fecha'}</div>
            ${medico.verificado ? `<div>‚úÖ Fecha de verificaci√≥n: ${medico.fechaVerificacion?.toDate().toLocaleString() || 'Sin fecha'}</div>` : `<button onclick="verificarMedico('${id}', this)">Verificar</button>`}
          </div>
        `;
        contenedor.addEventListener("click", () => {
          const detalles = contenedor.querySelector(".detalles");
          detalles.style.display = detalles.style.display === "block" ? "none" : "block";
        });

        if (medico.verificado) {
          verificadosDiv.appendChild(contenedor);
        } else {
          pendientesDiv.appendChild(contenedor);
        }
      });
    }

    window.verificarMedico = async function(id, btn) {
      const ref = doc(db, "medicos", id);
      await updateDoc(ref, {
        verificado: true,
        fechaVerificacion: serverTimestamp()
      });
      btn.disabled = true;
      btn.innerText = "Verificado";
      location.reload();
    };

    cargarMedicos();
  </script>
</body>
</html>
