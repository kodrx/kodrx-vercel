
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Debug Historial de Recetas</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <h2>Debug - Historial de Recetas</h2>
  <div id="estado"></div>
  <ul id="listaRecetas"></ul>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBIjaOe4HcGNDk0xrqen8etBv0RyjyOJHw",
      authDomain: "kodrx-105b9.firebaseapp.com",
      databaseURL: "https://kodrx-105b9-default-rtdb.firebaseio.com",
      projectId: "kodrx-105b9",
      storageBucket: "kodrx-105b9.appspot.com",
      messagingSenderId: "239675098141",
      appId: "1:239675098141:web:152ae3741b0ac79db7f2f4"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const estado = document.getElementById("estado");
    const lista = document.getElementById("listaRecetas");

    auth.onAuthStateChanged(user => {
      if (user) {
        const uid = user.uid;
        estado.innerText = "UID médico logueado: " + uid;

        db.ref("recetas").once("value").then(snapshot => {
          const recetas = snapshot.val();
          if (!recetas) {
            estado.innerText += "\nNo hay recetas registradas.";
            return;
          }

          let encontradas = 0;
          for (const id in recetas) {
            const receta = recetas[id];
            if (receta.uid_medico === uid) {
              encontradas++;
              const item = document.createElement("li");
              item.innerText = "Receta: " + id + " | Paciente: " + (receta.nombre_paciente || "N/A");
              lista.appendChild(item);
            }
          }

          if (encontradas === 0) {
            estado.innerText += "\nNo se encontraron recetas para este médico.";
          } else {
            estado.innerText += "\nTotal encontradas: " + encontradas;
          }
        });
      } else {
        estado.innerText = "Usuario no autenticado.";
      }
    });
  </script>
</body>
</html>
