<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultados de búsqueda</title>
  <style>
    body{font-family:system-ui;background:#f9fafb;color:#111;}
    .wrap{max-width:900px;margin:20px auto;padding:16px;}
    .result{padding:12px;margin-bottom:8px;border:1px solid #ddd;border-radius:8px;background:#fff;}
    .result h3{margin:0 0 6px;font-size:16px;color:#0b5bd3;}
    .result p{margin:0;font-size:14px;color:#444;}
 
  </style>
    <link rel="stylesheet" href="/estilos/global.css" />
  <script src="/componentes/header.js" defer></script>
</head>
<body>
  <div class="wrap">
    <h2>Resultados de búsqueda</h2>
    <div id="results">Cargando...</div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBIjaOe4HcGNDk0xrqen8etBv0RyjyOJHw",
      authDomain: "kodrx-105b9.firebaseapp.com",
      projectId: "kodrx-105b9"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const qParam = new URLSearchParams(location.search).get("q") || "";
    const resultsDiv = document.getElementById("results");

    async function buscar(){
      if(!qParam){ resultsDiv.textContent="No se ingresó búsqueda"; return; }
      const snap = await getDocs(collection(db,"recetas"));
      const matches = [];
      snap.forEach(doc=>{
        const d = doc.data();
        const nombre = d.nombrePaciente || d.pacienteNombre || d.paciente?.nombre || "";
        if(nombre.toLowerCase().includes(qParam.toLowerCase())){
          matches.push({id:doc.id,...d});
        }
      });
      if(matches.length===0){
        resultsDiv.textContent = "No se encontraron resultados.";
        return;
      }
      resultsDiv.innerHTML = matches.map(r=>`
        <div class="result">
          <h3><a href="ver-receta.html?id=${r.id}">${r.nombrePaciente || r.pacienteNombre || r.paciente?.nombre}</a></h3>
          <p>ID: ${r.id}</p>
          <p>${r.diagnostico || "Sin diagnóstico"}</p>
        </div>
      `).join("");
    }
    buscar();
  </script>
</body>
</html>

